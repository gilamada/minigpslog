C51 COMPILER V8.08   MAIN                                                                  06/18/2008 02:25:33 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\4.Obj\main.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 1.Main\main.c BROWSE INCDIR(.\2.Inc) DEBUG OBJECTEXTEND PRINT(.\5.List\main
                    -.lst) OBJECT(.\4.Obj\main.obj)

line level    source

   1          /*********************************************************************************************************
             -*********************
   2          ***Ä£¿éÃû³Æ£º ²âÊÔÖ÷³ÌÐò                                                                                  
             -                  ***
   3          ***Ä£¿é¹¦ÄÜ£º                                                                                             
             -                  ***                                                                                                                                                                                
   4          ***×÷    Õß£º METAL MAX,CUIT(liyangbbs@126.com)                                                           
             -                  ***
   5          ***µ÷ÓÃ·½Ê½£º                                                                                             
             -                  ***
   6          ***ÈÕ    Ö¾£º ÈÕÆÚ             °æ±¾                     ÐÞ¸ÄÈË                               ¼ÇÂ¼         
             -                  ***
   7          ***           06/10/2008       V1.01                    METALMAX                       ×ÜÌå×éºÏ²âÊÔÍ¨¹ý   
             -                  ***
   8          ***±¸    ×¢£º                                                                                             
             -                  ***
   9          **********************************************************************************************************
             -*******************/
  10          #include <reg52.h>
  11          #include <stdio.h>
  12          #include <math.h>                                                       /* T6963Çý¶¯¿â                    
             -                  */
  13          #include "DriverT6963.h"
  14          #include "DataBase.h"
  15          #include "PCF8583.h"
  16          #include "UART.h"
  17          
  18          unsigned char GblCnt = 0;
  19          unsigned char T0IRQCNT = 0;
  20          unsigned char oldtempx, oldtempy;
  21          unsigned int Angle;
  22          unsigned char keyflag = 0;
  23          extern unsigned char COMBUF[10];
  24          /*********************************************************************************************************
             -*********************
  25          **º¯ÊýÃû³Æ£ºdelay()                                                                                       
             -                   **
  26          **º¯Êý¹¦ÄÜ£ºÈí¼þÑÓ³Ù                                                                                      
             -                   **   
  27          **Èë¿Ú²ÎÊý£ºÑÓ³ÙÊ±¼ä±¶Êý                                                                                  
             -                   **
  28          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
  29          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
  30          **µ÷ÓÃ³ÌÐò£ºÎÞ                                                                                            
             -                   **
  31          **±¸    ×¢£ºÑÓÊ±²»¾«È·                                                                                    
             -                   **
  32          **********************************************************************************************************
             -********************/
  33          void delay(unsigned int time)
  34          {
  35   1         unsigned int i,j;
C51 COMPILER V8.08   MAIN                                                                  06/18/2008 02:25:33 PAGE 2   

  36   1         for (i=0; i<time; i++) {
  37   2           for (j=0; j<1700; j++){;}
  38   2         }
  39   1      }
  40          
  41          
  42          /*********************************************************************************************************
             -*********************
  43          **º¯ÊýÃû³Æ£ºDisCurTime()                                                                                  
             -                   **
  44          **º¯Êý¹¦ÄÜ£ºÔÚÖ¸¶¨Î»ÖÃÏÔÊ¾ÊµÊ±Ð¾Æ¬ÄÚµÄÊ±¼ä                                                                
             -                   **   
  45          **Èë¿Ú²ÎÊý£ºÏÔÊ¾Î»ÖÃx, y×ø±ê                                                                              
             -                   **
  46          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
  47          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
  48          **µ÷ÓÃ³ÌÐò£ºReadPCF8583(), DisStr()                                                                       
             -                   **
  49          **±¸    ×¢£º                                                                                              
             -                   **
  50          **********************************************************************************************************
             -********************/
  51          void DisCurTime(unsigned char x, unsigned char y)
  52          {
  53   1          unsigned char time[3];
  54   1              unsigned char dispBuff[9];
  55   1              ReadPCF8583(0x02, 3, time);
  56   1              dispBuff[8] = '\0';                                                 /* ÔÚÊý×é×îºóµ¥Ôª·ÅÈë±êÊ¶·ûÒÔ±ãÅÐ¶ÏÄÚ
             -ÈÝ½áÊø         */
  57   1          dispBuff[7] = (time[0] & 0x0f) + '0';                               /* ÌáÈ¡Ãë¸öÎ»                     
             -                  */
  58   1              dispBuff[6] = (time[0] >> 4)   + '0';                               /* ÌáÈ¡ÃëÊ®Î»                        
             -               */
  59   1              dispBuff[5] = ':';
  60   1              dispBuff[4] = (time[1] & 0x0f) + '0';                               /* ÌáÈ¡·Ö¸öÎ»                          
             -             */
  61   1              dispBuff[3] = (time[1] >> 4)   + '0';                               /* ÌáÈ¡·ÖÊ®Î»                        
             -               */
  62   1              dispBuff[2] = ':';
  63   1              dispBuff[1] = (time[2] & 0x0f) + '0';                               /* ÌáÈ¡Ê±¸öÎ»                          
             -             */
  64   1              dispBuff[0] = ((time[2] >> 4) & 0x03) + '0';                        /* ÌáÈ¡Ê±Ê®Î»                        
             -               */
  65   1              DispStr(y*20+x, dispBuff);
  66   1      }
  67          
  68          /*********************************************************************************************************
             -*********************
  69          **º¯ÊýÃû³Æ£ºÏÔÊ¾ÈÕÆÚ                                                                                      
             -                   **
  70          **º¯Êý¹¦ÄÜ£ºÔÚÖ¸¶¨Î»ÖÃÏÔÊ¾ÊµÊ±Ð¾Æ¬ÄÚµÄÈÕÆÚ                                                                
             -                   **   
  71          **Èë¿Ú²ÎÊý£ºÏÔÊ¾Î»ÖÃx, y×ø±ê                                                                              
             -                   **
  72          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
  73          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
  74          **µ÷ÓÃ³ÌÐò£ºReadPCF8583(), DisStr()                                                                       
             -                   **
C51 COMPILER V8.08   MAIN                                                                  06/18/2008 02:25:33 PAGE 3   

  75          **±¸    ×¢£º                                                                                              
             -                   **
  76          **********************************************************************************************************
             -********************/
  77          void DisCurDate(unsigned char x, unsigned char y)
  78          {
  79   1          unsigned char Date[2];
  80   1              unsigned char DisBuf[11];
  81   1              ReadPCF8583(0x05, 2, Date);                                         /* »ñÈ¡PCF8583µÄÈÕÆÚ                 
             -               */         
  82   1              DisBuf[4] = (Date[0] & 0x0f) + '0';                                     /* ÌáÈ¡ÈÕ¸öÎ»                        
             -               */
  83   1              DisBuf[3] = ((Date[0] >> 4) & 0x03) + '0';                          /* ÌáÈ¡ÈÕÊ®Î»                        
             -               */
  84   1              DisBuf[2] = '/';
  85   1              DisBuf[1] = (Date[1] & 0x0f) + '0';                                     /* ÌáÈ¡ÔÂ¸öÎ»                        
             -               */
  86   1              DisBuf[0] = ((Date[1] >> 4) & 0x01) + '0';                          /* ÌáÈ¡ÔÂÊ®Î»                        
             -               */
  87   1              DisBuf[5] = '/';
  88   1          DisBuf[6] = '2';
  89   1          DisBuf[7] = '0';
  90   1          DisBuf[8] = '0';
  91   1          DisBuf[9] = '8';
  92   1          DisBuf[10]= '\0';                                                   /* ÔÚÊý×é×îºóµ¥Ôª·ÅÈë±êÊ¶·ûÒÔ±ãÅÐ¶
             -ÏÄÚÈÝ½áÊø         */
  93   1          DispStr(y*20+x, DisBuf);
  94   1      }
  95          
  96          /*********************************************************************************************************
             -*********************
  97          **º¯ÊýÃû³Æ£ºDisClock()                                                                                    
             -                   **
  98          **º¯Êý¹¦ÄÜ£º»æÖÆÖÓÃæ                                                                                      
             -                   **   
  99          **Èë¿Ú²ÎÊý£ºÏÔÊ¾Î»ÖÃ                                                                                      
             -                   **
 100          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 101          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 102          **µ÷ÓÃ³ÌÐò£ºCircle(), Line(), WriteEN(), EasyCH()                                                         
             -                   **
 103          **±¸    ×¢£º                                                                                              
             -                   **
 104          **********************************************************************************************************
             -********************/
 105          void DrawClock(unsigned char x, unsigned char y, unsigned char r)
 106          {
 107   1          Circle(x, y, r);
 108   1          Line(x, y-r, x, y-r+5, 0);                                          /* »æÖÆ0µã´¦ÊúÏß                  
             -                  */
 109   1          Line(x, y+r, x, y+r-5, 0);                                          /* »æÖÆ6µã´¦ÊúÏß                  
             -                  */
 110   1          Line(x-r, y, x-r+5, y, 0);                                          /* »æÖÆ9µã´¦ÊúÏß                  
             -                  */
 111   1          Line(x+r, y, x+r-5, y, 0);                                          /* »æÖÆ3µã´¦ÊúÏß                  
             -                  */
 112   1          WriteEN(198,'E');
 113   1          WriteEN(273,'S');
 114   1          WriteEN(189,'W');
 115   1          WriteEN(93,'N');
C51 COMPILER V8.08   MAIN                                                                  06/18/2008 02:25:33 PAGE 4   

 116   1          EasyCH(3, 1, fang);
 117   1          EasyCH(3, 2, wei);
 118   1      }
 119          
 120          
 121          /*********************************************************************************************************
             -*********************
 122          **º¯ÊýÃû³Æ£ºGraphicTest()                                                                                 
             -                   **
 123          **º¯Êý¹¦ÄÜ£ºÏÔÊ¾×Óº¯Êý²âÊÔ³ÌÐò                                                                            
             -                   **   
 124          **Èë¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 125          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 126          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 127          **µ÷ÓÃ³ÌÐò£ºÏÔÊ¾×Óº¯Êý                                                                                    
             -                   **
 128          **±¸    ×¢£º                                                                                              
             -                   **
 129          **********************************************************************************************************
             -********************/
 130          void GraphicTest(void)
 131          {
 132   1              Circle(80, 63, 60);
 133   1              Rectangle(0, 0, 159, 127, 0);
 134   1              Triangle(0, 0, 20, 30, 120, 50);
 135   1              Line(0, 0, 159, 127, 0);
 136   1              Line(0, 127, 159, 0, 1);
 137   1      }
 138          
 139          /*********************************************************************************************************
             -*********************
 140          **º¯ÊýÃû³Æ£ºDisMain()                                                                                     
             -                   **
 141          **º¯Êý¹¦ÄÜ£ºÖ÷ÏÔÊ¾½çÃæ                                                                                    
             -                   **   
 142          **Èë¿Ú²ÎÊý£ºÏÔÊ¾Î»ÖÃ                                                                                      
             -                   **
 143          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 144          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 145          **µ÷ÓÃ³ÌÐò£ºÎÞ                                                                                            
             -                   **
 146          **±¸    ×¢£º½öÓÃ×÷²âÊÔÊ¹ÓÃ                                                                                
             -                   **
 147          **********************************************************************************************************
             -********************/
 148          void DisMain(void)
 149          {
 150   1          Rectangle(0, 22, 159, 127, 0);
 151   1          DrawClock(113, 70, 45);    
 152   1          Line(0, 115, 159, 115, 0);
 153   1          Line(64, 22, 64, 115, 0);
 154   1      }
 155          
 156          
 157          /*********************************************************************************************************
             -*********************
 158          **º¯ÊýÃû³Æ£ºDisCurDirc()                                                                                  
C51 COMPILER V8.08   MAIN                                                                  06/18/2008 02:25:33 PAGE 5   

             -                   **
 159          **º¯Êý¹¦ÄÜ£ºÏÔÊ¾µ±Ç°·½Î»Ö¸Õë                                                                              
             -                   **   
 160          **Èë¿Ú²ÎÊý£ºÏÔÊ¾½Ç¶È                                                                                      
             -                   **
 161          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 162          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 163          **µ÷ÓÃ³ÌÐò£ºWriteEN(), Line()                                                                             
             -                   **
 164          **±¸    ×¢£º                                                                                              
             -                   **
 165          **********************************************************************************************************
             -********************/
 166          void DisCurDirc(unsigned int Dir)
 167          {
 168   1          unsigned char tempx, tempy;
 169   1          unsigned char Dir1, Dir2, Dir3;
 170   1          
 171   1          Dir1 = Dir/100 +'0';                                                /* ÌáÈ¡Æä¸÷Î»                     
             -                  */
 172   1          Dir2 = (Dir%100)/10 + '0';
 173   1          Dir3 = (Dir%100)%10 + '0';
 174   1          WriteEN(122, Dir1);
 175   1          WriteEN(123, Dir2);
 176   1          WriteEN(124, Dir3);
 177   1          
 178   1          Dir = Dir/3;                                                        /* ²»Âú3µÄ±¶ÊýµÄ°´3µÄ±¶ÊýËã       
             -                  */
 179   1          tempx = DirTbl[(Dir<<1)];
 180   1          tempy = DirTbl[((Dir<<1)+1)];
 181   1          LineClr(113, 70, oldtempx, oldtempy);
 182   1          Line(113, 70, tempx, tempy, 0); 
 183   1          oldtempx = tempx;
 184   1          oldtempy = tempy;
 185   1      }
 186          
 187          /*********************************************************************************************************
             -*********************
 188          **º¯ÊýÃû³Æ£ºSendAngle()                                                                                   
             -                   **
 189          **º¯Êý¹¦ÄÜ£ºÏò´®¿ÚËÍµ±Ç°½Ç¶ÈÖµ                                                                            
             -                   **   
 190          **Èë¿Ú²ÎÊý£ºµ±Ç°½Ç¶È                                                                                      
             -                   **
 191          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 192          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 193          **µ÷ÓÃ³ÌÐò£ºUartSendStr(), UartSendByte()                                                                 
             -                   **
 194          **±¸    ×¢£º                                                                                              
             -                   **
 195          **********************************************************************************************************
             -********************/
 196          void SendAngle(unsigned int Dir)
 197          {
 198   1          unsigned char Dir1, Dir2, Dir3;    
 199   1          unsigned char Str[] = "Current angle = 360 degree !";
 200   1      
 201   1          Dir1 = Dir/100 +'0';                                                /* ÌáÈ¡Æä¸÷Î»                     
C51 COMPILER V8.08   MAIN                                                                  06/18/2008 02:25:33 PAGE 6   

             -                  */
 202   1          Dir2 = (Dir%100)/10 + '0';
 203   1          Dir3 = (Dir%100)%10 + '0'; 
 204   1          
 205   1          sprintf(Str, "Current angle = %c%c%c degree !", Dir1,Dir2,Dir3);
 206   1          UartSendStr(Str);
 207   1          UartSendByte(0x0d);
 208   1          UartSendByte(0x0a); 
 209   1      }
 210          
 211          /*********************************************************************************************************
             -*********************
 212          **º¯ÊýÃû³Æ£ºÍâ²¿ÖÐ¶Ï0 ISR                                                                                 
             -                   **
 213          **º¯Êý¹¦ÄÜ£º»ñÈ¡¼üÖµ                                                                                      
             -                   **   
 214          **Èë¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 215          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 216          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 217          **µ÷ÓÃ³ÌÐò£ºÎÞ                                                                                            
             -                   **
 218          **±¸    ×¢£º                                                                                              
             -                   **
 219          **********************************************************************************************************
             -********************/
 220          INT0IRQ (void) interrupt 0
 221          {
 222   1          unsigned char keytmp;
 223   1          EA = 0;
 224   1          delay(10);
 225   1          keytmp = (P1 & 0xf8);                                               /* ±£Áô¸ß5Î»                      
             -                  */
 226   1          if (keytmp == 0xf8) {                                               /* ¶¶¶¯                           
             -                  */
 227   2          EA = 1;
 228   2          }else {
 229   2              switch (keytmp) {                                               /* Key1                           
             -                  */
 230   3                  case 0x78 : 
 231   3                      keyflag = 1;
 232   3                      break;                                                  /* Key2                           
             -                  */
 233   3                  case 0xb8 : break;                                          /* Key3                           
             -                  */
 234   3                  case 0xd8 : break;                                          /* Key4                           
             -                  */
 235   3                  case 0xe8 : break;                                          /* Key5                           
             -                  */
 236   3                  case 0xf0 : break;
 237   3                  default : break;
 238   3              }
 239   2          EA = 1;
 240   2          }
 241   1      }
 242          
 243          
 244          
 245          /*********************************************************************************************************
             -*********************
C51 COMPILER V8.08   MAIN                                                                  06/18/2008 02:25:33 PAGE 7   

 246          **º¯ÊýÃû³Æ£º¶¨Ê±Æ÷0 ISR                                                                                   
             -                   **
 247          **º¯Êý¹¦ÄÜ£º¶¨Ê±Æ÷0ÖÐ¶Ï·þÎñ³ÌÐò                                                                           
             -                   **   
 248          **Èë¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 249          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 250          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 251          **µ÷ÓÃ³ÌÐò£ºÎÞ                                                                                            
             -                   **
 252          **±¸    ×¢£º                                                                                              
             -                   **
 253          **********************************************************************************************************
             -********************/
 254          T0IRQ (void) interrupt 1
 255          {
 256   1          EA  = 0;
 257   1          TR0 = 0;
 258   1          T0IRQCNT++;
 259   1          TR0 = 1;
 260   1          EA  = 1;
 261   1      }
 262          
 263          
 264          /*********************************************************************************************************
             -*********************
 265          **º¯ÊýÃû³Æ£ºGetAngle()                                                                                    
             -                   **
 266          **º¯Êý¹¦ÄÜ£º»ñÈ¡·½Ïò½Ç¶È                                                                                  
             -                   **   
 267          **Èë¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 268          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 269          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 270          **µ÷ÓÃ³ÌÐò£ºÎÞ                                                                                            
             -                   **
 271          **±¸    ×¢£º                                                                                              
             -                   **
 272          **********************************************************************************************************
             -********************/
 273          void GetAngle(void)
 274          {
 275   1          unsigned char Dir1, Dir2, Dir3;    
 276   1                                          
 277   1          Dir1 = COMBUF[0] - '0';
 278   1          if (Dir1 > 3) {
 279   2              
 280   2          }else {
 281   2              Dir2 = COMBUF[1] - '0';
 282   2              Dir3 = COMBUF[2] - '0'; 
 283   2              Angle = Dir1 * 100 + Dir2 * 10 + Dir3;
 284   2          }
 285   1      }
 286          
 287          
 288          /*********************************************************************************************************
             -*********************
 289          **º¯ÊýÃû³Æ£ºÖ÷²âÊÔº¯Êý                                                                                    
C51 COMPILER V8.08   MAIN                                                                  06/18/2008 02:25:33 PAGE 8   

             -                   **
 290          **º¯Êý¹¦ÄÜ£º                                                                                              
             -                   **   
 291          **Èë¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 292          **³ö¿Ú²ÎÊý£ºÎÞ                                                                                            
             -                   **
 293          **¾ßÌå×ÊÔ´£ºÎÞ                                                                                            
             -                   **
 294          **µ÷ÓÃ³ÌÐò£ºÎÞ                                                                                            
             -                   **
 295          **±¸    ×¢£º                                                                                              
             -                   **
 296          **********************************************************************************************************
             -********************/
 297          
 298          void main(void)
 299          {
 300   1          InitScreen();
 301   1          
 302   1          InitCOM();
 303   1          DisMain();
 304   1          EX0 = 1;                                                            /* Íâ²¿ÖÐ¶Ï0¿ª                    
             -                  */
 305   1          IT0 = 1;                                                            /* Íâ²¿ÖÐ¶Ï0Îª±ßÑØ´¥·¢            
             -                  */
 306   1      
 307   1          DisCurDate(0, 15);                                                  /* ÏÔÊ¾ÏµÍ³ÈÕÆÚ                   
             -                  */
 308   1          Angle = 1;
 309   1          while(1)
 310   1              {
 311   2              GetAngle();
 312   2              if (T0IRQCNT == 5) {
 313   3                  DisCurDirc(Angle);
 314   3              }
 315   2              DisCurTime(11, 15);                                             /* ÏÔÊ¾ÏµÍ³Ê±¼ä                   
             -                  */                         
 316   2              switch (keyflag) {
 317   3                  case 1 : 
 318   3                      SendAngle(Angle);
 319   3                      keyflag = 0;
 320   3                      break;
 321   3                  default : break;
 322   3              }                                               
 323   2          }
 324   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1135    ----
   CONSTANT SIZE    =   5632    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7      71
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
