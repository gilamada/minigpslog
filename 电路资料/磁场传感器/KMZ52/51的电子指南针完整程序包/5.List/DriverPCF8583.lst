C51 COMPILER V8.08   DRIVERPCF8583                                                         05/27/2008 00:23:22 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE DRIVERPCF8583
OBJECT MODULE PLACED IN .\4.Obj\DriverPCF8583.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 3.Source\DriverPCF8583.c BROWSE INCDIR(.\2.Inc) DEBUG OBJECTEXTEND PRINT(.\
                    -5.List\DriverPCF8583.lst) OBJECT(.\4.Obj\DriverPCF8583.obj)

line level    source

   1          #include <reg52.h>
   2          #include "PinDefine.h"
   3          #include "DriverPCF8583.h"
   4          #include <intrins.h>
   5          
   6           /********************************************************************************************************
             -********************
   7           **函数名称：I2C总线启动                                                                                  
             -                  **
   8           **函数功能：启动信号                                                                                     
             -                  **   
   9           **入口参数：无                                                                                           
             -                  **
  10           **出口参数：无                                                                                           
             -                  **
  11           **具体资源：无                                                                                           
             -                  **
  12           **调用程序：无                                                                                           
             -                  **
  13           **备    注：                                                                                             
             -                  **
  14           *********************************************************************************************************
             -*******************/
  15          void IIC_Start(void)
  16          {
  17   1           EA   = 0; 
  18   1           SDA  = 1;
  19   1           SCL  = 1;  
  20   1           _nop_();
  21   1           SDA  = 0;
  22   1           _nop_();
  23   1           SCL  = 0;
  24   1       }
  25          
  26          
  27           /********************************************************************************************************
             -********************
  28           **函数名称：I2C总线结束信号                                                                              
             -                  **
  29           **函数功能：结束I2C总线                                                                                  
             -                  **   
  30           **入口参数：无                                                                                           
             -                  **
  31           **出口参数：无                                                                                           
             -                  **
  32           **具体资源：无                                                                                           
             -                  **
  33           **调用程序：无                                                                                           
             -                  **
  34           **备    注：                                                                                             
             -                  **
  35           *********************************************************************************************************
             -*******************/
  36          void IIC_Stop(void)
C51 COMPILER V8.08   DRIVERPCF8583                                                         05/27/2008 00:23:22 PAGE 2   

  37          {
  38   1          SDA = 0;
  39   1          SCL = 0;
  40   1          _nop_();
  41   1          SCL = 1;
  42   1          _nop_();
  43   1          SDA = 1; 
  44   1          EA = 1;   
  45   1       }
  46          
  47          
  48           /********************************************************************************************************
             -********************
  49           **函数名称：SendByte                                                                                     
             -                  **
  50           **函数功能：发送一个字节                                                                                 
             -                  **   
  51           **入口参数：显示位置                                                                                     
             -                  **
  52           **出口参数：无                                                                                           
             -                  **
  53           **具体资源：无                                                                                           
             -                  **
  54           **调用程序：无                                                                                           
             -                  **
  55           **备    注：                                                                                             
             -                  **
  56           *********************************************************************************************************
             -*******************/
  57          void  IICSendByte(unsigned char tx_byte)
  58          {
  59   1          unsigned char i;
  60   1          for (i=0;i<8;i++) {
  61   2              if (tx_byte & 0x80) {
  62   3                  SDA = 1;     
  63   3              }else{ 
  64   3                  SDA = 0;
  65   3              }
  66   2              tx_byte <<= 1;   
  67   2              SCL = 1;  
  68   2              _nop_();  
  69   2              SCL = 0;  
  70   2          }
  71   1       }
  72          
  73          
  74           /********************************************************************************************************
             -********************
  75           **函数名称：WaitACK                                                                                      
             -                  **
  76           **函数功能：等待ACK                                                                                      
             -                  **   
  77           **入口参数：无                                                                                           
             -                  **
  78           **出口参数：无                                                                                           
             -                  **
  79           **具体资源：无                                                                                           
             -                  **
  80           **调用程序：无                                                                                           
             -                  **
  81           **备    注：                                                                                             
             -                  **
C51 COMPILER V8.08   DRIVERPCF8583                                                         05/27/2008 00:23:22 PAGE 3   

  82           *********************************************************************************************************
             -*******************/
  83          void IIC_WaitAck(void)
  84          {
  85   1          unsigned char waitTime = 0xff;  
  86   1          SDA = 1;  
  87   1          SCL = 1;  
  88   1          _nop_();
  89   1          while(SDA) {
  90   2              waitTime--;
  91   2              if (!waitTime) {
  92   3                  SCL = 0;
  93   3                  IIC_Stop();
  94   3              }
  95   2          }
  96   1          SCL = 0; 
  97   1       }
  98          
  99          
 100           /********************************************************************************************************
             -********************
 101           **函数名称：IICRcvByte                                                                                   
             -                     **
 102           **函数功能：接收一个字节                                                                                 
             -                  **   
 103           **入口参数：无                                                                                           
             -                  **
 104           **出口参数：接收到的一个字节                                                                             
             -                  **
 105           **具体资源：无                                                                                           
             -                  **
 106           **调用程序：无                                                                                           
             -                  **
 107           **备    注：                                                                                             
             -                  **
 108           *********************************************************************************************************
             -*******************/
 109          unsigned char  IICRcvByte(void)
 110          {
 111   1          unsigned char tmp = 0;
 112   1          unsigned char i;
 113   1      
 114   1          for (i=0;i<8;i++) {
 115   2              SCL = 0;
 116   2              SDA = 1;
 117   2              _nop_();
 118   2              SCL = 1;
 119   2              _nop_();
 120   2              tmp <<= 1;
 121   2              if (SDA) {
 122   3                  tmp |= 0x01;
 123   3              }
 124   2          }
 125   1          SCL = 0;
 126   1          return tmp; 
 127   1       }
 128          
 129          
 130           /********************************************************************************************************
             -********************
 131           **函数名称：IICSendACK                                                                                   
             -                  **
C51 COMPILER V8.08   DRIVERPCF8583                                                         05/27/2008 00:23:22 PAGE 4   

 132           **函数功能：发送应答信号                                                                                 
             -                  **   
 133           **入口参数：无                                                                                           
             -                  **
 134           **出口参数：无                                                                                           
             -                  **
 135           **具体资源：无                                                                                           
             -                  **
 136           **调用程序：无                                                                                           
             -                  **
 137           **备    注：                                                                                             
             -                  **
 138           *********************************************************************************************************
             -*******************/
 139          void  IIC_SendAck(void)
 140          {
 141   1          SDA = 0;
 142   1          _nop_();
 143   1          SCL = 1;
 144   1          _nop_();
 145   1          SCL = 0;
 146   1       }
 147          
 148          
 149           /********************************************************************************************************
             -********************
 150           **函数名称：IICSendNACK                                                                                  
             -                  **
 151           **函数功能：发送非应答信号                                                                               
             -                  **   
 152           **入口参数：显示位置                                                                                     
             -                  **
 153           **出口参数：无                                                                                           
             -                  **
 154           **具体资源：无                                                                                           
             -                  **
 155           **调用程序：无                                                                                           
             -                  **
 156           **备    注：                                                                                             
             -                  **
 157           *********************************************************************************************************
             -*******************/
 158          void  IICSendNACK(void)
 159          {
 160   1          SDA = 1;
 161   1          _nop_();
 162   1          SCL = 1;
 163   1          _nop_();
 164   1          SCL = 0;
 165   1       }
 166          
 167           /********************************************************************************************************
             -********************
 168           **函数名称：ReadPCF8583                                                                                  
             -                  **
 169           **函数功能：读取PCF8583内部寄存器                                                                        
             -                  **   
 170           **入口参数：Addr-起始地址，Num-要读取的数据个数，buff-读取后装入缓存首地址                               
             -                  **
 171           **出口参数：无                                                                                           
             -                  **
 172           **具体资源：无                                                                                           
C51 COMPILER V8.08   DRIVERPCF8583                                                         05/27/2008 00:23:22 PAGE 5   

             -                  **
 173           **调用程序：无                                                                                           
             -                  **
 174           **备    注：                                                                                             
             -                  **
 175           *********************************************************************************************************
             -*******************/
 176          void ReadPCF8583(unsigned char Addr, unsigned char Num, unsigned char *buff)
 177          {
 178   1          unsigned char i;
 179   1          IICStart();   
*** WARNING C206 IN LINE 179 OF 3.SOURCE\DRIVERPCF8583.C: 'IICStart': missing function-prototype
 180   1          IICSendByte(0xa0); 
 181   1          IICWaitAck();  
*** WARNING C206 IN LINE 181 OF 3.SOURCE\DRIVERPCF8583.C: 'IICWaitAck': missing function-prototype
 182   1          IICSendByte(addrInter); 
*** ERROR C202 IN LINE 182 OF 3.SOURCE\DRIVERPCF8583.C: 'addrInter': undefined identifier
 183   1          IICWaitAck();     
 184   1          
 185   1          IICStart();   
 186   1          IICSendByte(0xa1); 
 187   1          IICWaitAck();
 188   1           
 189   1          for (i=0; i<num-1; i++) {
*** ERROR C202 IN LINE 189 OF 3.SOURCE\DRIVERPCF8583.C: 'num': undefined identifier
 190   2              buff[i] = IICRcvByte(); 
 191   2              IICSendACK();    
 192   2          }
 193   1          buff[num-1] = IICRcvByte();
 194   1          IICSendNACK();    
 195   1          IICStop();  
 196   1       }
 197           /********************************************************************************************************
             -********************
 198           **函数名称：显示时间                                                                                     
             -                  **
 199           **函数功能：在指定位置显示实时芯片内的时间                                                               
             -                  **   
 200           **入口参数：显示位置                                                                                     
             -                  **
 201           **出口参数：无                                                                                           
             -                  **
 202           **具体资源：无                                                                                           
             -                  **
 203           **调用程序：无                                                                                           
             -                  **
 204           **备    注：                                                                                             
             -                  **
 205           *********************************************************************************************************
             -*******************/
 206          void PCF8583_WriteDat(unsigned char addrInter,unsigned char num,unsigned char *buff)
 207          {
 208   1       unsigned char i;
 209   1       
 210   1          IIC_Start();
 211   1          IIC_TxByte(0xa0);
 212   1          IIC_WaitAck();
 213   1       
 214   1          IIC_TxByte(addrInter);
 215   1          IIC_WaitAck();
 216   1       
 217   1          for (i=0; i<num; i++) {
C51 COMPILER V8.08   DRIVERPCF8583                                                         05/27/2008 00:23:22 PAGE 6   

 218   2              IIC_TxByte(buff[i]);
 219   2              IIC_WaitAck();
 220   2          }
 221   1       
 222   1       IIC_Stop();
 223   1       }
 224           /********************************************************************************************************
             -********************
 225           **函数名称：显示时间                                                                                     
             -                  **
 226           **函数功能：在指定位置显示实时芯片内的时间                                                               
             -                  **   
 227           **入口参数：显示位置                                                                                     
             -                  **
 228           **出口参数：无                                                                                           
             -                  **
 229           **具体资源：无                                                                                           
             -                  **
 230           **调用程序：无                                                                                           
             -                  **
 231           **备    注：                                                                                             
             -                  **
 232           *********************************************************************************************************
             -*******************/
 233          void PCF8583_WriteByte(unsigned char addrInter,unsigned char val)
 234          {
 235   1          IIC_Start();
 236   1       
 237   1          IIC_TxByte(0xa0);
 238   1          IIC_WaitAck();
 239   1       
 240   1          IIC_TxByte(addrInter);
 241   1          IIC_WaitAck();
 242   1          IIC_TxByte(val);
 243   1          IIC_WaitAck();
 244   1          IIC_Stop();
 245   1       }
 246          
 247          void PCF8583_Init(void)
 248          {
 249   1          PCF8583_WriteByte(0x00,0x00);
 250   1      }
 251          

C51 COMPILATION COMPLETE.  2 WARNING(S),  2 ERROR(S)
